<html>
<head>
    <meta charset="UTF-8">
    <title>测试</title>
    <script src="https://cdn.staticfile.org/video.js/8.5.3/video.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdn.staticfile.org/video.js/8.5.3/video-js.min.css" />
</head>
<body>
<button onclick="copyLink()">分享一起看链接</button>
<button onclick="syncProgress()">同步</button>
<!-- 假设你的Django路由是/streaming/ -->
<video disabled id="myVideo" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto" style="height: 100%; width: 100%">
        <source id="source" src="{{ m3u8Url }}" type="application/x-mpegURL">
</video>



<script>
var token = "{{ token }}"
// 复制链接
function copyLink() {
    // 获取到域名根
    var Url = location.protocol + "//" + location.host;
    var Url2 = Url + '/streaming/' + token;
    var oInput = document.createElement('input');
    oInput.value = Url2;
    document.body.appendChild(oInput);
    oInput.select(); // 选择对象
    document.execCommand("Copy"); // 执行浏览器复制命令
    oInput.className = 'oInput';
    oInput.style.display = 'none';
    alert('复制成功');
}

// 同步进度
function syncProgress() {
    // 获取进度并设置到播放器
    fetch('/progress?token=' + token, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json'
        }
    }).then(res => {
        res.json().then(data => {
            if (data.status === 'play') {
                hander.currentTime(data.currentTime);
                hander.play();
            } else {
                hander.currentTime(data.currentTime);
                hander.pause();
            }
        })
    })

}

// videojs 简单使用
hander = videojs('myVideo', {
    bigPlayButton: true,
    textTrackDisplay: false,
    posterImage: false,
    errorDisplay: false
})

// 页面加载完成后自动播放
hander.ready(function () {
    var player = this;
    player.play();
    player.on('ended', function () {
        player.play();
    });
    // 同步进度
    syncProgress();
});

// 点击播放前先同步进度
hander.on('play', function () {
    syncProgress();
})


var token = "{{ token }}";

// 一分钟同步一次进度
setInterval(syncProgress, 3 * 1000);


</script>
</body>
</html>

